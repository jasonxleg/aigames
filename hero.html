<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¼«å¨ï¼šäº”æ ¼å¤§å†’éšª</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Noto+Sans+TC:wght@700&display=swap');

        :root {
            --marvel-red: #EC1D24;
            --marvel-dark: #101010;
            --comic-bg: #f2f2f2;
            --panel-border: 4px solid #000;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            background-color: #333;
            font-family: 'Noto Sans TC', sans-serif;
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        /* æ‰‹æ©Ÿæ¡†æ¶ */
        #game-device {
            width: 100%;
            max-width: 480px;
            height: 100%;
            background: var(--comic-bg);
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            /* æ¼«ç•«ç¶²é»èƒŒæ™¯ */
            background-image: radial-gradient(#ccc 15%, transparent 16%), radial-gradient(#ccc 15%, transparent 16%);
            background-size: 20px 20px;
        }

        /* æ¨™é¡Œåˆ— */
        header {
            background: var(--marvel-red);
            color: white;
            padding: 10px;
            text-align: center;
            font-family: 'Bangers', cursive;
            font-size: 1.5rem;
            border-bottom: 4px solid black;
            z-index: 10;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        .score-board { font-size: 1rem; font-family: 'Noto Sans TC'; }

        /* æ¼«ç•«æ²å‹•å€ (å‚ç›´é•·æ¢) */
        #comic-strip {
            flex-grow: 1;
            overflow-y: auto;
            padding: 20px 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            scroll-behavior: smooth;
        }

        /* æ¼«ç•«æ ¼å­æ¨£å¼ */
        .panel {
            background: white;
            border: var(--panel-border);
            box-shadow: 6px 6px 0px rgba(0,0,0,0.8);
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 140px;
            opacity: 0;
            transform: translateY(50px);
            transition: all 0.5s ease-out;
            position: relative;
        }

        /* æ ¼å­å‡ºç¾å‹•ç•« */
        .panel.show { opacity: 1; transform: translateY(0); }

        /* å·¦ä¸Šè§’ç·¨è™Ÿ */
        .panel-badge {
            position: absolute; top: -10px; left: -5px;
            background: #FFD700; color: black; border: 2px solid black;
            padding: 2px 8px; font-family: 'Bangers'; font-size: 1.2rem;
            transform: rotate(-10deg);
        }

        .emoji-art { font-size: 4rem; line-height: 1.2; filter: drop-shadow(2px 2px 0 #ccc); }
        
        .caption {
            background: #fff;
            border: 2px solid black;
            padding: 5px 10px;
            margin-top: 5px;
            font-weight: bold;
            font-size: 1.1rem;
            text-align: center;
            width: 90%;
            /* æ¼«ç•«å°è©±æ¡†æ¨£å¼ */
            border-radius: 10px 10px 10px 0px;
        }

        /* ç¬¬äº”æ ¼ï¼šäº’å‹•å€ */
        .panel.interactive {
            border-color: var(--marvel-red);
            background: #fff0f0;
        }

        .btn-group {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }

        .choice-btn {
            background: white;
            border: 3px solid black;
            padding: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            text-align: left;
            position: relative;
            font-family: 'Noto Sans TC';
            transition: 0.1s;
        }
        .choice-btn:active { background: black; color: white; transform: scale(0.98); }
        .choice-btn::before { content: "â–¶ "; color: var(--marvel-red); }

        /* éå ´èˆ‡çµç®— */
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
        }
        
        .comic-word {
            font-family: 'Bangers';
            font-size: 5rem;
            color: #FFD700;
            text-shadow: 4px 4px var(--marvel-red);
            transform: rotate(-5deg);
            animation: zoomIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .result-text { margin: 20px; font-size: 1.4rem; line-height: 1.5; }
        
        .action-btn {
            background: var(--marvel-red); color: white; border: 3px solid white;
            padding: 10px 30px; font-size: 1.5rem; font-family: 'Bangers';
            cursor: pointer; margin-top: 20px;
        }

        @keyframes zoomIn { from { transform: scale(0) rotate(-20deg); } to { transform: scale(1) rotate(-5deg); } }

    </style>
</head>
<body>

<div id="game-device">
    <header>
        <span>MARVEL COMICS</span>
        <div class="score-board">
            SCORE: <span id="score">0</span> | BEST: <span id="best">0</span>
        </div>
    </header>

    <div id="comic-strip">
        </div>

    <div id="overlay">
        <div class="comic-word" id="sfx">BOOM!</div>
        <div class="result-text" id="result-msg">...</div>
        <button class="action-btn" id="next-btn" onclick="nextLevel()">NEXT ISSUE >></button>
    </div>
</div>

<script>
    // --- éŠæˆ²è³‡æ–™ (äº”æ ¼æ¼«ç•«åŠ‡æœ¬) ---
    const levels = {
        1: {
            panels: [
                { e: "ğŸ™ï¸", t: "ç´ç´„å¸‚ï¼Œæ™´æœ—çš„æ—©æ™¨..." },
                { e: "ğŸ›¸", t: "çªç„¶ï¼å·¨å‹ç”œç”œåœˆé£›èˆ¹å‡ºç¾ï¼" },
                { e: "ğŸ‘½", t: "çƒæœ¨å–‰ï¼šã€æŠŠå¯¶çŸ³äº¤å‡ºä¾†ï¼ã€" },
                { e: "ğŸ§™â€â™‚ï¸", t: "å¥‡ç•°åšå£«æ­£åœ¨è²·ä¸‰æ˜æ²»ï¼Œæ²’ç©ºï¼" },
                { e: "ğŸ’", t: "æˆ‘æ˜¯å¯¦ç¿’ç”Ÿï¼Œæˆ‘è©²æ€éº¼è¾¦ï¼Ÿ" } // ç¬¬5æ ¼å•é¡Œ
            ],
            choices: [
                { text: "ä¸Ÿå‡ºèœ˜è››äººå™´çµ²", next: 2, score: 1, sfx: "THWIP!", res: "æˆåŠŸé»ä½é£›èˆ¹å¼•æ“ï¼å®ƒå¢œæ¯€äº†ï¼" },
                { text: "æ‰“é›»è©±çµ¦é‹¼éµäºº", next: 2, score: 0, sfx: "RING...", res: "èªéŸ³ä¿¡ç®±...ä½ è¢«æŠ“èµ°äº†ã€‚" }
            ]
        },
        2: {
            panels: [
                { e: "ğŸšï¸", t: "æˆ°å ´è½‰ç§»åˆ°æ³°å¦æ˜Ÿå»¢å¢Ÿ" },
                { e: "ğŸ˜ˆ", t: "è–©è«¾æ–¯èµ°äº†å‡ºä¾†ï¼Œéœ¸æ°£å¤–éœ²" },
                { e: "ğŸ¥Š", t: "ä»–èˆ‰èµ·ç„¡é™æ‰‹å¥—æº–å‚™å½ˆæŒ‡" },
                { e: "ğŸ˜´", t: "è³è‚å¥³æ­£è©¦è‘—è®“ä»–ç¡è‘—" },
                { e: "âš¡", t: "æ˜Ÿçˆµçœ‹èµ·ä¾†è¦çˆ†æ°£äº†ï¼" }
            ],
            choices: [
                { text: "é˜»æ­¢æ˜Ÿçˆµæä»–", next: 3, score: 1, sfx: "STOP!", res: "æ‰‹å¥—é †åˆ©è„«ä¸‹ä¾†äº†ï¼å®‡å®™å¾—æ•‘ï¼" },
                { text: "å¹«æ˜Ÿçˆµä¸€èµ·æ", next: 3, score: 0, sfx: "SMASH!", res: "è–©è«¾æ–¯é†’äº†ï¼ŒåŠå€‹å®‡å®™å†è¦‹ã€‚" }
            ]
        },
        3: {
            panels: [
                { e: "ğŸ›¡ï¸", t: "æœ€çµ‚æˆ°å½¹ï¼šå¾©ä»‡è€…åŸºåœ°" },
                { e: "ğŸŒŠ", t: "æ´ªæ°´è¡éä¾†äº†ï¼" },
                { e: "ğŸ”¨", t: "ç¾åœ‹éšŠé•·éœ€è¦æ­¦å™¨" },
                { e: "ğŸ•¸ï¸", t: "ä½ çœ‹åˆ°åœ°ä¸Šæœ‰å…©æ¨£æ±è¥¿" },
                { e: "ğŸ¤”", t: "å¿«ä¸Ÿçµ¦éšŠé•·ï¼é¸ä¸€å€‹ï¼" }
            ],
            choices: [
                { text: "é›·ç¥ä¹‹éš MjÃ¶lnir", next: 'end', score: 1, sfx: "WHAM!", res: "éšŠé•·èˆ‰èµ·éšå­ï¼å–Šå‡ºäº† ASSEMBLEï¼" },
                { text: "ç„¡ç·šé›»å°è¬›æ©Ÿ", next: 'end', score: 0, sfx: "BZZT...", res: "éšŠé•·ï¼šã€æˆ‘éœ€è¦æ­¦å™¨ï¼Œä¸æ˜¯èŠå¤©ï¼ã€" }
            ]
        },
        'end': {
            panels: [
                { e: "ğŸ¬", t: "æ•…äº‹çµæŸ" },
                { e: "ğŸ†", t: "çµç®—æˆç¸¾" },
                { e: "ğŸ˜º", t: "æ„Ÿè¬éŠç©" },
                { e: "ğŸ”", t: "æˆ‘å€‘å»åƒæ²™å¨ç‘ªå§" },
                { e: "â†º", t: "æƒ³å†æ¬¡æŒ‘æˆ°å—ï¼Ÿ" }
            ],
            choices: [
                { text: "é‡æ–°é–‹å§‹å®‡å®™é‡å•Ÿ", next: 1, score: 0, sfx: "REWIND", res: "æ™‚é–“å¯¶çŸ³ç™¼å‹•..." },
                { text: "åˆ†äº«æˆ°ç¸¾", next: 1, score: 0, sfx: "SHARE", res: "ä½ æ˜¯çœŸæ­£çš„è‹±é›„ï¼" } // é‚è¼¯ä¸Šé€™æœƒé‡ç½®
            ]
        }
    };

    // --- éŠæˆ²ç‹€æ…‹ç®¡ç† ---
    let currentLvl = 1;
    let score = 0;
    let bestScore = localStorage.getItem('marvel_best') || 0;
    
    const els = {
        strip: document.getElementById('comic-strip'),
        score: document.getElementById('score'),
        best: document.getElementById('best'),
        overlay: document.getElementById('overlay'),
        sfx: document.getElementById('sfx'),
        resultMsg: document.getElementById('result-msg'),
        nextBtn: document.getElementById('next-btn')
    };

    function init() {
        score = 0;
        currentLvl = 1;
        updateUI();
        renderLevel(1);
    }

    function updateUI() {
        els.score.innerText = score;
        els.best.innerText = bestScore;
    }

    function renderLevel(lvlIdx) {
        // æ¸…ç©ºæ¼«ç•«å€
        els.strip.innerHTML = ''; 
        const data = levels[lvlIdx];
        
        // ä¾åºç”¢ç”Ÿ5æ ¼
        data.panels.forEach((p, index) => {
            const isLast = index === 4; // ç¬¬5æ ¼ (index 4)
            const panelDiv = document.createElement('div');
            panelDiv.className = isLast ? 'panel interactive' : 'panel';
            panelDiv.id = `p-${index}`;
            
            let html = `
                <div class="panel-badge">#${index + 1}</div>
                <div class="emoji-art">${p.e}</div>
                <div class="caption">${p.t}</div>
            `;

            // å¦‚æœæ˜¯ç¬¬5æ ¼ï¼ŒåŠ å…¥æŒ‰éˆ•
            if (isLast) {
                let btnsHtml = '<div class="btn-group">';
                data.choices.forEach(c => {
                    btnsHtml += `<button class="choice-btn" onclick="makeChoice('${c.next}', ${c.score}, '${c.sfx}', '${c.res}')">${c.text}</button>`;
                });
                btnsHtml += '</div>';
                html += btnsHtml;
            }

            panelDiv.innerHTML = html;
            els.strip.appendChild(panelDiv);
        });

        // å•Ÿå‹•ç€‘å¸ƒæµå‹•ç•«
        animatePanels();
    }

    function animatePanels() {
        const panels = document.querySelectorAll('.panel');
        panels.forEach((p, i) => {
            setTimeout(() => {
                p.classList.add('show');
                // è‡ªå‹•æ²å‹•åˆ°åº•éƒ¨
                if (i > 1) {
                    els.strip.scrollTo({ top: els.strip.scrollHeight, behavior: 'smooth' });
                }
            }, i * 600); // æ¯ 0.6 ç§’å‡ºç¾ä¸€æ ¼
        });
    }

    window.makeChoice = function(nextLvl, point, sfxText, resultText) {
        // æ›´æ–°åˆ†æ•¸
        if (point > 0) score += point;
        if (score > bestScore) {
            bestScore = score;
            localStorage.setItem('marvel_best', bestScore);
        }
        updateUI();

        // é¡¯ç¤ºéå ´
        els.sfx.innerText = sfxText;
        els.resultMsg.innerText = resultText;
        els.overlay.style.display = 'flex';
        
        // è¨­å®šä¸‹ä¸€é—œæŒ‰éˆ•è¡Œç‚º
        els.nextBtn.onclick = function() {
            els.overlay.style.display = 'none';
            if (nextLvl === 'end') {
                renderLevel('end'); // ç‰¹æ®Šçµå±€é—œå¡
            } else if (sfxText === "REWIND") {
                init(); // é‡ç½®
            } else if (sfxText === "SHARE") {
                alert(`æˆ‘å¾—äº† ${score} åˆ†ï¼æ¼«å¨å¯¦ç¿’ç”Ÿå ±åˆ°ï¼`);
                init();
            } else {
                currentLvl = nextLvl;
                renderLevel(nextLvl);
            }
        };
    };

    // å•Ÿå‹•éŠæˆ²
    els.best.innerText = bestScore;
    init();

</script>
</body>
</html>
