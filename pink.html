<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>頑皮豹：搶救炎夏大作戰 (手機版)</title>
    <style>
        /* --- 全局設定，確保在手機上不亂跑 --- */
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background-color: #f0e68c;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 10px;
            min-height: 100vh; /* 確保佔滿全螢幕高度 */
            box-sizing: border-box;
            touch-action: manipulation; /* 優化手機點擊反應 */
        }

        h1 {
            color: #d63384;
            text-shadow: 2px 2px 0px #000;
            font-size: clamp(1.5rem, 5vw, 2.5rem); /* 自動調整字體大小 */
            margin: 10px 0;
            text-align: center;
        }

        /* --- 遊戲主容器 (響應式設計核心) --- */
        /* 我們定義一個基於 800x400 (2:1) 的比例 */
        #game-container {
            width: 100%;           /* 佔滿可用寬度 */
            max-width: 800px;      /* 但最大不超過 800px */
            aspect-ratio: 2 / 1;   /* 鎖定縱橫比為 2:1，高度會自動計算 */
            background-color: #ffcc00;
            border: 3px solid #000;
            position: relative;
            overflow: hidden;
            background-image: linear-gradient(to bottom, #ffcc00 60%, #e6b800 60%);
            box-shadow: 5px 5px 0px rgba(0,0,0,0.2);
            margin: auto; /* 置中 */
            cursor: pointer; /* 讓電腦版滑鼠變手型 */
            /* 禁止手機上長按選取內容 */
            -webkit-user-select: none;
            user-select: none;
        }

        /* --- 遊戲素材 (使用百分比定位以實現縮放) --- */
        .sprite {
            background-size: 200% 200%;
            position: absolute;
            background-repeat: no-repeat;
        }

        /* 炎熱的男人 */
        /* 原本 200x200, 相對於容器 800x400 的比例 */
        #little-man {
            width: 25%;  /* 200 / 800 */
            height: 50%; /* 200 / 400 */
            background-position: 15% 25%;
            bottom: 5%;  /* 20 / 400 */
            left: 50%;
            transform: translateX(-50%);
            z-index: 1;
        }

        /* 行走的頑皮豹與影子容器 */
        /* 原本 300x350 */
        #panther-container {
            position: absolute;
            width: 37.5%;  /* 300 / 800 */
            height: 87.5%; /* 350 / 400 */
            bottom: 2.5%;  /* 10 / 400 */
            left: -40%;    /* 起始位置在螢幕外 */
            z-index: 2;
        }

        #panther-sprite {
            width: 100%;
            height: 100%;
            background-position: 85% 20%;
        }
        
        /* 用於碰撞檢測的影子區域 (相對於 panther-container 的比例) */
        /* 原本 140x60, left 80. 父容器 300x350 */
        #shadow-hitbox {
            position: absolute;
            width: 46.6%;  /* 140 / 300 */
            height: 17.1%; /* 60 / 350 */
            bottom: 0;
            left: 26.6%;   /* 80 / 300 */
            /* border: 2px solid red; 開啟此行可除錯影子位置 */
        }

        /* --- 遊戲介面元素 --- */
        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0,0,0,0.7);
            z-index: 10;
            color: white;
            text-align: center;
        }

        button {
            padding: 10px 20px;
            font-size: clamp(1rem, 4vw, 1.5rem); /* 響應式字體 */
            background-color: #d63384;
            border: 3px solid #000;
            color: white;
            cursor: pointer;
            font-family: inherit;
            margin-top: 20px;
        }
        button:active { transform: scale(0.95); }

        #instructions {
            font-size: clamp(1rem, 3vw, 1.2rem);
            background: rgba(255,255,255,0.9);
            color: black;
            padding: 15px;
            border: 3px solid black;
            width: 80%;
            max-width: 400px;
        }

        /* --- 結果畫面 --- */
        #result-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 5;
            display: none;
            background-color: #ffcc00;
        }

        .result-fail {
            width: 100%; height: 100%;
            background-position: 100% 100%;
            background-size: 200% 200%;
        }

        .result-win {
            width: 100%; height: 100%;
            background-color: #87CEEB;
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 5%;
            position: relative;
        }
        
        .win-text {
            position: absolute;
            top: 5%;
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            color: white;
            text-shadow: 2px 2px 4px blue;
            width: 100%;
            text-align: center;
        }

        /* 勝利畫面的角色尺寸也需要改為百分比 */
        #win-panther {
            width: 31.25%; /* 250 / 800 */
            height: 75%;   /* 300 / 400 */
            background-position: 95% 90%; 
            background-size: 250% 250%;
        }

        #win-man-in-shadow {
            width: 22.5%;  /* 180 / 800 */
            height: 45%;   /* 180 / 400 */
            background-color: black;
            border-radius: 50%;
            position: relative;
            margin-left: -6%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        #cool-man {
            width: 83%; height: 83%; /* 相對於 shadow container */
            background-position: 15% 25%;
            background-size: 300% 300%;
            filter: grayscale(100%) brightness(150%) sepia(30%) hue-rotate(180deg);
            transform: translateY(10%);
        }

        /* 動畫類別 (使用百分比移動) */
        .walking {
            animation: walkAcross 4s linear forwards;
        }

        @keyframes walkAcross {
            from { left: -40%; }
            to { left: 110%; }
        }

    </style>
</head>
<body>

    <h1>頑皮豹：搶奪影子大作戰</h1>

    <div id="game-container">
        <div id="little-man" class="sprite"></div>
        <div id="panther-container">
            <div id="panther-sprite" class="sprite"></div>
            <div id="shadow-hitbox"></div>
        </div>
        <div id="result-overlay"></div>
        <div id="ui-layer">
            <div id="instructions">
                <p>外面太熱了！</p>
                <p>等頑皮豹的影子經過你頭上時...</p>
                <p><strong>點擊螢幕</strong>跳進去！</p>
            </div>
            <button id="start-btn">開始遊戲</button>
        </div>
    </div>

    <script>
        const panther = document.getElementById('panther-container');
        const man = document.getElementById('little-man');
        const shadowBox = document.getElementById('shadow-hitbox');
        const uiLayer = document.getElementById('ui-layer');
        const startBtn = document.getElementById('start-btn');
        const resultOverlay = document.getElementById('result-overlay');
        const gameContainer = document.getElementById('game-container');
        const instructionsText = document.getElementById('instructions');

        let isPlaying = false;

        // 綁定開始按鈕事件 (同時支援 click 和 touchstart)
        startBtn.addEventListener('click', startGame);
        startBtn.addEventListener('touchstart', startGame, {passive: false});

        function startGame(e) {
            // 防止同時觸發 click 和 touchstart
            if (e && e.type === 'touchstart') e.preventDefault();

            isPlaying = true;
            uiLayer.style.display = 'none';
            resultOverlay.style.display = 'none';
            resultOverlay.innerHTML = '';
            panther.classList.remove('walking');
            void panther.offsetWidth; // 強制重繪
            panther.classList.add('walking');

            // --- 核心修改：新增觸控支援 ---
            // 同時監聽滑鼠點擊和手指觸碰
            gameContainer.addEventListener('click', checkHit);
            // passive: false 允許我們在需要時使用 preventDefault
            gameContainer.addEventListener('touchstart', checkHit, {passive: false});
            
            panther.addEventListener('animationend', miss);
        }

        function checkHit(e) {
            if (!isPlaying) return;

            // --- 核心修改：防止重複觸發 ---
            // 如果是觸控事件，阻止它繼續觸發後續的模擬滑鼠點擊
            if (e.type === 'touchstart') {
                e.preventDefault();
            }

            const manRect = man.getBoundingClientRect();
            const shadowRect = shadowBox.getBoundingClientRect();
            const shadowCenter = shadowRect.left + (shadowRect.width / 2);
            
            // 碰撞判定 (保持不變，getBoundingClientRect 會自動處理縮放後的實際位置)
            if (shadowCenter > manRect.left && shadowCenter < manRect.right) {
                winGame();
            } else {
                loseGame();
            }
        }

        function stopGame() {
            isPlaying = false;
            panther.classList.remove('walking');
            // --- 核心修改：移除兩種監聽器 ---
            gameContainer.removeEventListener('click', checkHit);
            gameContainer.removeEventListener('touchstart', checkHit);
            panther.removeEventListener('animationend', miss);
            uiLayer.style.display = 'flex';
            startBtn.innerText = "再試一次";
        }

        function winGame() {
            stopGame();
            resultOverlay.style.display = 'block';
            resultOverlay.innerHTML = `
                <div class="result-win">
                    <h2 class="win-text">成功! 好涼快啊!</h2>
                    <div id="win-man-in-shadow">
                        <div id="cool-man" class="sprite"></div>
                    </div>
                    <div id="win-panther" class="sprite"></div>
                </div>
            `;
            applyImageToSprites(); // 確保新加入的元素也有圖片
        }

        function loseGame() {
            stopGame();
            resultOverlay.style.display = 'block';
            resultOverlay.innerHTML = '<div class="result-fail sprite"></div>';
            applyImageToSprites();
        }

        function miss() {
             if (isPlaying) {
                stopGame();
                instructionsText.innerHTML = "<p>你錯過影子了！太慢啦！</p>";
             }
        }

        // --- 圖片連結設置 ---
        const yourImageURL = 'https://raw.githubusercontent.com/jasonxleg/aigames/main/pinker.jpg';

        function applyImageToSprites() {
            document.querySelectorAll('.sprite').forEach(el => {
                el.style.backgroundImage = `url('${yourImageURL}')`;
            });
        }

        // 初始應用圖片
        applyImageToSprites();

    </script>
</body>
</html>
